{% extends 'layout.html' %}

{% block content %}
<div class="timeline">
    <div class="followings half">
        <h2>Following</h2>
        {% if user.Followings %}
        {% for following in user.Followings %}
        <div class="pill following-item" data-user-id="{{following.id}}">
            <span class="nickname">{{following.nick}}</span>
            <button class="unfollow-btn" data-user-id="{{following.id}}">π…‡</button>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="followers half">
        <h2>Follower</h2>
        {% if user.Followers %}
        {% for follower in user.Followers %}
        <div class="pill follower-item" data-user-id="{{follower.id}}">
            <span class="nickname">{{follower.nick}}</span>
            <button class="remove-follower-btn" data-user-id="{{follower.id}}">π…‡</button>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="contents half">
        <h2>Posts</h2>
        {% if user.Posts %}
        {% for post in user.Posts %}
        <div class="post-item">
            <div class="post-content">{{post.content}}</div>
            {% if post.img %}
            <div class="post-image">
                <img src="{{post.img}}" alt="ν¬μ¤νΈ μ΄λ―Έμ§€" class="post-img">
            </div>
            {% endif %}
            <div class="post-date">{{post.createdAt}}</div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-posts">μ•„μ§ μ‘μ„±ν• κΈ€μ΄ μ—†μµλ‹λ‹¤.</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    // μ–Έν”λ΅μ° λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ
    document.querySelectorAll('.unfollow-btn').forEach(function (btn) {
        btn.addEventListener('click', function () {
            const userId = this.getAttribute('data-user-id');
            if (confirm('ν”λ΅μ‰μ„ μ·¨μ†ν•μ‹κ² μµλ‹κΉ?')) {
                axios.delete(`/user/${userId}/following`)
                    .then(() => {
                        // μ„±κ³µ μ‹ ν•΄λ‹Ή ν”λ΅μ‰ ν•­λ© μ κ±°
                        this.closest('.following-item').remove();
                    })
                    .catch((err) => {
                        console.error('μ–Έν”λ΅μ° μ‹¤ν¨:', err);
                        alert('μ–Έν”λ΅μ°μ— μ‹¤ν¨ν–μµλ‹λ‹¤.');
                    });
            }
        });
    });

    // ν”λ΅μ› μ κ±° λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ
    document.querySelectorAll('.remove-follower-btn').forEach(function (btn) {
        btn.addEventListener('click', function () {
            const userId = this.getAttribute('data-user-id');
            if (confirm('ν”λ΅μ›λ¥Ό μ κ±°ν•μ‹κ² μµλ‹κΉ?')) {
                axios.delete(`/user/${userId}/follower`)
                    .then(() => {
                        // μ„±κ³µ μ‹ ν•΄λ‹Ή ν”λ΅μ› ν•­λ© μ κ±°
                        this.closest('.follower-item').remove();
                    })
                    .catch((err) => {
                        console.error('ν”λ΅μ› μ κ±° μ‹¤ν¨:', err);
                        alert('ν”λ΅μ› μ κ±°μ— μ‹¤ν¨ν–μµλ‹λ‹¤.');
                    });
            }
        });
    });
</script>
{% endblock %}